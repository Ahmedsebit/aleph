<div class="jumbotron">
  <h1>{{::statistics.documents_count | number}} gazettes</h1>
  <p class="teaser">from {{metadata.app.start_year}} to {{metadata.app.end_year}} available</p>
  <div class="search-area">
    <form class="form-horizontal actions" role="search" ng-submit="searchDocuments(form)">
      <div class="input-group">
        <input type="text" class="form-control" autofocus ng-model="documentsQuery.q"
            placeholder="{{::statistics.documents_count | number}} documents">
        <span class="input-group-btn">
          <button class="btn btn-primary" type="submit">Search</button>
        </span>
      </div>
      <p class="context sample-searches">
        Examples:
        <span ng-repeat="sample in metadata.app.samples">
          <span ng-if="$last">or</span>
          <a href="/documents?q={{::sample}}">{{::sample}}</a>
          <span ng-if="!$last">,</span>
        </span>
        ,
          or
        <a href="/documents/sources">browse sources</a>
        .
      </p>
    </form>
  </div>
</div>

<div class="home screen">
  <div class="row">
    <div class="col-md-4 feature">
      <h2> <i class="fa fa-fw fa-file-text"></i>
        Search documents
      </h2>

      <p>
        {{metadata.app.title}} lets you search across
        <a href="/collections">
          {{::statistics.collections_count | number}} collections
        of {{metadata.app.nationality}} gazettes
        </a>
        from {{metadata.app.opengazettes_url}}
      </p>
    </div>

    <div class="col-md-4 feature" ng-if="::!authz.logged_in()">
      <h2> <i class="fa fa-bell"></i>
        E-Mail Alerts
      </h2>
      <p>
        As new material gets added, you can stay informed about
        any additional matches for your previous searches by
        setting up e-mail alerts.
      </p>

    </div>

    <div class="col-md-4 feature">
      <h2>
        <i class="fa fa-fw fa-users"></i>
        Persons of interest
      </h2>
      <p>
        Gazettes are cross-referenced with persons and companies by ID and CIPC numbers respectively.
      </p>
      <form class="form-horizontal actions" role="search" ng-submit="searchEntities(form)">
        <div class="input-group">
          <input type="text" class="form-control" autofocus ng-model="entitiesQuery.q"
            placeholder="{{::statistics.entities_count | number}} people and companies">
          <span class="input-group-btn">
            <button class="btn btn-primary" type="submit">Search</button>
          </span>
        </div>
        <p class="context">
          <a href="/datasets">Browse databases</a>.
        </p>
      </form>
    </div>
  </div>
  <div class="row dark-row">
    <div style="text-align: center;">
      <h2> <i class="fa fa-fw fa-newspaper-o"></i>
        What's Happening
      </h2>
    </div>
      <div id="newsCarousel" class="carousel slide" ng-non-bindable data-interval="false" data-ride="carousel">

      <!-- Indicators -->
        <ol class="carousel-indicators">

        </ol>

        <!-- Wrapper for slides -->
        <div class="carousel-inner">


          <!-- Left and right controls -->
          <a class="carousel-control" data-target="#newsCarousel" data-slide="prev">
            <span class="glyphicon glyphicon-chevron-left"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="right-ctrl carousel-control" data-target="#newsCarousel" data-slide="next">
            <span class="glyphicon glyphicon-chevron-right"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>
    </div>
  </div>
<script>
  var spreadsheetID = "1SN02GD7b4d2dqrbgfrWE2bclSorXYF5E6UqhNFjaWig";
  var url = "https://spreadsheets.google.com/feeds/list/" + spreadsheetID + "/od6/public/values?alt=json";
  var max_title_len = 80;
  var max_description_len = 150;
  $.getJSON(url, function(data) {
    var entry = data.feed.entry;
    var news_set_index = 0;
    var newsCarousel = $('#newsCarousel');
    var carouselInner = newsCarousel.children('.carousel-inner');
    var carouselIndicator = newsCarousel.children('.carousel-indicators');
    var news_row = '';
    $(entry).each(function(index) {
      // Columns: Title, Descriptions, Publish Date, Author Name, Image URL, Story URL.
      console.log("news_set_index before: " + news_set_index);
      if (index % 4 === 0) {
        var active = "";
        if (news_set_index === 0) {
          active = "active";
        } else {
          active = "";
        }
        // Create a new news set div
        carouselInner.append(
        '<div id="news-set-' + news_set_index + '" class="item ' + active + '"></div>');
        // Create a new indicator for the new news-set
        carouselIndicator.append(
        '<li data-target="#newsCarousel" data-slide-to="' + news_set_index +
        '" class="' + active + '"></li>');
        // Finally increment the news-set index
        news_set_index += 1;
        console.log("incrementing news_set_index: " + news_set_index);
      }
      var newsSet = carouselInner.children('#news-set-' + (news_set_index - 1));
      var title = this.gsx$title.$t;
      var description = this.gsx$descriptions.$t;
      var story_url = this.gsx$storyurl.$t;
      var author_name = this.gsx$authorname.$t;
      var publish_date = this.gsx$publishdate.$t;



      if (title.length > max_title_len) {
          title = title.substring(0,max_title_len) + "...";
      }
      if (description.length > max_description_len) {
          description= description.substring(0,max_description_len) + "...";
      }
      var end = false;
      if (entry.length == index + 1 ){
          end = true;
      }
      var new_news_row = '';
      var end_news_row = '';
      if (index % 2 === 0) {
          news_row = '';
          new_news_row = '<div class="col-md-12">';
          end_news_row = '';
      } else {
          new_news_row = '';
          end_news_row = '</div>';
          end = true;
      }
      news_row += new_news_row +
          '<a href="' + story_url +'"><div class="col-md-6 news-item">'
          + '<h2>' + title + '</h2>'
          + '<div class="date">' + publish_date + '</div>'
          + '<p>' + description + '</p>'
          + '</div></a>' + end_news_row;
      if (end) {
          newsSet.append(news_row);
      }
    });
  });
</script>
<style>
  .item .col-md-12 .news-item {
    background: rgba(0, 0, 0, 0.15);
    border-left: 12px solid #3a4953;
    border-bottom: 12px solid #3a4953;
    margin-bottom: -1000px;
    padding-bottom: 1000px;
    min-height: 150px;
    transition: background-color 0.2s ease-out;
    -webkit-transition: background-color 0.2s ease-out;
    -moz-transition: background-color 0.2s ease-out;
    -o-transition: background-color 0.2s ease-out;

  }
  .date {
    margin-left: 10px;
    font-style: italic;
    font-size: 0.8em;
    color: #fff;
  }
  .item a{
    color: #fff;
    cursor: pointer;
    text-decoration: none;
  }

  .item a .news-item h2{
    padding: 10px 10px 0 10px;
    margin-bottom: 0;
    font-size: 1.2em;
    word-wrap: break-word;
  }

  .item a .news-item p{
    padding: 10px 10px 0 10px;
  }

  .item a .news-item:hover{
    background-color: rgba(0, 0, 0, 0.10);
    cursor: pointer;
  }
  .item .col-md-12 {
    /*background: rgba(0, 0, 0, 0.25);*/
    border-bottom: 12px solid #3a4953;
    overflow: hidden;
  }

  @media (max-width: 991px) {
    .item .col-md-12 .news-item{
      margin-bottom: 0;
      padding-bottom: 0;
    }

  }

</style>
